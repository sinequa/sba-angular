<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tipstricks/plugins" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Server-side Plugins | Sinequa SBA Framework</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/sba-angular/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/sba-angular/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/sba-angular/docs/tipstricks/plugins"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Server-side Plugins | Sinequa SBA Framework"><meta data-rh="true" name="description" content="The SBA framework offers a great deal of flexibility for customizing the client-side of your application, but sometimes the web services of Sinequa need to be customized on the server side."><meta data-rh="true" property="og:description" content="The SBA framework offers a great deal of flexibility for customizing the client-side of your application, but sometimes the web services of Sinequa need to be customized on the server side."><link data-rh="true" rel="icon" href="/sba-angular/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/sba-angular/docs/tipstricks/plugins"><link data-rh="true" rel="alternate" href="https://github.com/sba-angular/docs/tipstricks/plugins" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/sba-angular/docs/tipstricks/plugins" hreflang="x-default"><link rel="stylesheet" href="/sba-angular/assets/css/styles.3d4ad778.css">
<script src="/sba-angular/assets/js/runtime~main.7afd9482.js" defer="defer"></script>
<script src="/sba-angular/assets/js/main.7c34123d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sba-angular/"><div class="navbar__logo"><img src="/sba-angular/assets/index/sinequa-logo-light-sm.png" alt="Sinequa Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/sba-angular/assets/index/sinequa-logo-light-sm.png" alt="Sinequa Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SBA Framework</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sba-angular/docs">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sinequa/sba-angular" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sba-angular/docs">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sba-angular/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/sba-angular/docs/guides">Guides</a><button aria-label="Expand sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/sba-angular/docs/tutorial">Tutorial</a><button aria-label="Expand sidebar category &#x27;Tutorial&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/sba-angular/docs/libraries">Libraries</a><button aria-label="Expand sidebar category &#x27;Libraries&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/sba-angular/docs/apps">Applications</a><button aria-label="Expand sidebar category &#x27;Applications&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/sba-angular/docs/tipstricks">Tips and Tricks</a><button aria-label="Collapse sidebar category &#x27;Tips and Tricks&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/debugging">Debugging your app</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/metadata">Custom metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/entities">Custom entities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/responsive-design">Responsive Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/user-preferences">User preferences</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/user-settings">User settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/environment">Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/login-methods">Login methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/thirdparty">Third Party Libraries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/d3-angular">D3 and Angular</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/speed-performance">Speed and Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/export-standalone">Exporting Standalone Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/audit">Auditing applications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/sba-angular/docs/tipstricks/plugins">Server-side Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/startup">Application Startup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sba-angular/docs/tipstricks/query-intent">Query Intent Detection</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/sba-angular/docs/releases">Releases</a><button aria-label="Expand sidebar category &#x27;Releases&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sba-angular/docs/contact">Contact</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/sba-angular/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/sba-angular/docs/tipstricks"><span itemprop="name">Tips and Tricks</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Server-side Plugins</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Server-side Plugins</h1>
<p>The SBA framework offers a great deal of flexibility for customizing the client-side of your application, but sometimes the web services of Sinequa need to be customized on the server side.</p>
<p>The platform offers two types of C# plugins that may be useful:</p>
<ul>
<li><code>QueryPlugin</code>: A plugin to customize the behavior of the Query web service (which is in charge of retrieving content from Sinequa indexes). This plugin is typically used to customize the SQL query sent to the engine, or post-process the results returned by the engine.</li>
<li><code>JsonMethodPlugin</code>: A plugin that can expose a new entirely custom REST API method. This plugin is typically used to create a custom service, independent of the regular search queries.</li>
</ul>
<p>Note that former <code>SearchPlugin</code> can generally be replaced by either a <code>QueryPlugin</code> or some customization on the client-side (in the Angular source code). Similarly, the former <code>PagePlugin</code> will need to be replaced by a custom <a href="https://angular.io/guide/router" target="_blank" rel="noopener noreferrer">Angular route</a>, and possibly a custom Query web service or a <code>JsonMethodPlugin</code> to fetch its data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="query-plugins">Query Plugins<a href="#query-plugins" class="hash-link" aria-label="Direct link to Query Plugins" title="Direct link to Query Plugins">​</a></h2>
<p>A <code>QueryPlugin</code> is a C# plugin deployed on the Sinequa server and assigned to a specific Query web service configuration.</p>
<p><img decoding="async" loading="lazy" alt="Query Plugin" src="/sba-angular/assets/images/query-plugin-d0d66e914fc0c7f82a7a35300b4ef27a.png" width="697" height="215" class="img_ev3q"></p>
<p>The Query web service has a rich API which can be used in many different ways. Unlike other plugins, the <code>QueryPlugin</code> is NOT a class with blank hook methods called by the main web service. Instead, the plugin class implements a large part of the logic of the web service, and this <code>QueryPlugin</code> class is always used by the web service, <em>even when you don&#x27;t create a plugin</em>. When you do create a <code>QueryPlugin</code>, you are overriding the service&#x27;s behavior directly (not just hooking into it).</p>
<p>It is also important to know that other web services make use of the <code>QueryPlugin</code>. For example the Query Export web service need to fetch data in a way that is consistent with the Query web service, before exporting that data.</p>
<p>The <code>QueryPlugin</code> has many methods which can be overriden, and we cannot go in the details of all of them here. However, we can split these methods in the following categories:</p>
<ul>
<li>Initialization: These methods initialize the properties of the <code>QueryPlugin</code> class in function of the user&#x27;s query. The query object sent by the client corresponds to the <code>Query</code> type, which is used throughout the SBA framework.</li>
<li>Before Search: These methods can be overriden to modify the way the SQL query is built (eg. to add, remove or modify specific SQL clauses).</li>
<li>After Search: These methods can be overriden to post-process the results of the SQL query and/or modify how these results are writen in the JSON response.</li>
</ul>
<p>The complete API of the <code>QueryPlugin</code> is listed on <a href="https://doc.sinequa.com/api/.net/html/T_Sinequa_Plugins_QueryPlugin.htm" target="_blank" rel="noopener noreferrer">Sinequa&#x27;s documentation website</a>.</p>
<p>Note that within a <code>QueryPlugin</code>, you have access to various useful objects, in particular:</p>
<ul>
<li><code>this.Request</code>: The query object (a <code>Json</code> object) that this web service is responding to. It is possible to access any sub property of the query (which can include non-standard properties, added specifically for the purpose of customization).</li>
<li><code>this.Response</code>: The response returned by the web service (a <code>Json</code> object). It is possible to modify any property of this response. Note that, depending on the method you override, <code>this.Response</code> might not always have the same content (for example, if you override a &quot;before search&quot; method, the response does not contain any data yet). From the front-end point of view, this response is read as a <code>Results</code> object.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="initialization-methods">Initialization methods<a href="#initialization-methods" class="hash-link" aria-label="Direct link to Initialization methods" title="Direct link to Initialization methods">​</a></h3>
<p>The initialization methods start with the prefix <code>Init</code>. The following methods are called in succession by the main <code>Init()</code> method (which itself may be overriden):</p>
<ul>
<li><code>InitAction()</code>: Initializes the <code>Action</code> member from the query (no action means this is a regular search query; &quot;open&quot; is a specific type of query for obtaining the nested values in a tree aggregation; &quot;aggregate&quot; is a specific type of query for computing a given list of aggregations, with custom settings).</li>
<li><code>InitAggregations()</code>: Initializes the <code>Aggregations</code> member from the query and the aggregations defined in the Query web service configuration.</li>
<li><code>InitOpenAggregations()</code>: Initializes the <code>OpenAggregations</code> member when the query action is &quot;open&quot;.</li>
<li><code>InitEngineClient()</code>: Sets the <code>Client</code> member to an instance taken from the pool if it has not already been set. Also sets <code>Indexes</code> and <code>IndexList</code>.</li>
<li><code>InitConditions()</code>: Initializes the <code>Conditions</code> member based on the full text, select or open conditions and advanced conditions specified in the query (sub-methods: <code>InitSelectConditions()</code>, <code>InitAdvancedConditions()</code> and  <code>PreProcessConditions()</code>).</li>
<li><code>InitTabSearch()</code>: Initializes the <code>TabSearch</code> member based on the Query configuration.</li>
<li><code>InitScope()</code>: Initializes the <code>Scope</code> member based on the <code>scope</code> value in the query and the web service configuration.</li>
<li><code>InitIds()</code>: Initializes the <code>Ids</code> member based on the <code>ids</code> value in the query.</li>
<li><code>InitBasket()</code>: Initializes the <code>Basket</code> member based on the basket value in the query.</li>
<li><code>InitTab()</code>: Initializes the <code>Tab</code>&quot; member based on the <code>tab</code> value in the query.</li>
</ul>
<p>It is rarely needed to override these methods, and more common to override the following ones (which actually perform some actions).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="before-search-methods">Before Search methods<a href="#before-search-methods" class="hash-link" aria-label="Direct link to Before Search methods" title="Direct link to Before Search methods">​</a></h3>
<p>The methods that build the SQL query sent to the engine start with the prefix <code>Add</code>. The <code>ToSql()</code> method calls <code>ToSqlInternal()</code>, which calls in sequence the methods responsible for each sub-part of the query. These methods are themselves subdivided as follows:</p>
<ul>
<li><code>AddSelect()</code>: Adds the SELECT clause of the SQL query<!-- -->
<ul>
<li><code>AddTabSearchDistribution()</code>: Used when tab search is active, to compute the counters displayed for each tab.</li>
<li><code>AddStandardColumns()</code>: Adds the columns of the index to the query.</li>
<li><code>AddRelevanceColumns()</code>: Adds the columns specific to a full text search (where relevance is computed), such as <code>globalrelevance</code> and <code>matchlocations</code>, <code>extractlocations</code> clauses.</li>
<li><code>AddGroupCountColumn()</code>: Adds the <code>groupcount</code> column when a GROUP BY clause is active.</li>
<li><code>AddQueryColumns()</code>: Adds columns defined in the query.</li>
<li><code>AddAdditionalSelectClause()</code>: Adds columns defined in the Query web service configuration.</li>
<li><code>AddOpenAggregations()</code>: Adds the aggregation clause when the action is &quot;open&quot; (not used in regular search queries, only when the user &quot;opens&quot; a collapsed node in a tree facet).</li>
<li><code>AddAggregations()</code>: Adds all the aggregations configured as &quot;included in standard search&quot; (unless specific actions like &quot;open&quot; or &quot;aggregate&quot;).<!-- -->
<ul>
<li><code>AddAggregation()</code>: Adds one aggregation, based on its configuration in the Query web service.</li>
</ul>
</li>
</ul>
</li>
<li><code>AddFrom()</code>: Adds the FROM clause of the SQL query, based on the list of index specified in the Query web service configuration.</li>
<li><code>AddWhere()</code>: Adds the WHERE clause of the SQL query<!-- -->
<ul>
<li><code>AddBasketIds()</code>: Adds the list of ids present in a basket (when a basket is requested in the query).</li>
<li><code>AddTextContains()</code>: Adds the &quot;text contains&quot; clause (when text is requested in the query).</li>
<li><code>AddProcessEntities()</code>: Adds the &quot;process-entities&quot; clause (when configured in the web service configuration).</li>
<li><code>AddIds()</code>: Adds the list of ids (when ids are request in the query)</li>
<li><code>AddGlobalSelections()</code>: Adds configured &quot;global selections&quot;. Global selections can be set on for the treepath and collection columns.</li>
<li><code>AddConditions()</code>: Adds any metadata selection specified in the search text. Such selections can be specified using the Sinequa fielded search syntax.</li>
<li><code>AddTabSelection()</code>: Adds the tab selection, if any. This is called both when building the tab and main query. For the tab query all possible tab values will be included. For the main query the values for the currently selected tab will be included.</li>
<li><code>AddScope()</code>: Adds the scope, if any. Scopes can be configured on the query in the administration console (similar to tabs, with more flexibility).</li>
<li><code>AddAdditionalWhereClause()</code>: Adds the configured &quot;additional where clause&quot;, if any.</li>
<li><code>AddRelevanceParameters()</code>: Adds the relevance-related clauses. This methods calls a long list of other methods, each responsible for an individual clause: <code>AddClassicSpellingCorrection()</code>, <code>AddDocumentWeight()</code>, <code>AddTextPartWeights()</code>, <code>AddRelevanceTransforms()</code>, <code>AddSynonyms()</code>, <code>AddReformulations()</code>, <code>AddDefaultSNS()</code>, <code>AddStopWords()</code>, <code>AddLightWords()</code>, <code>AddRawWords()</code>, <code>AddRequiredWords()</code>, <code>AddRewritings()</code>, <code>AddSpellingCorrectionFilter()</code>, <code>CreateInitialSearchParameters()</code>, <code>AddDefaultLanguage()</code>, <code>AddLanguageWeights()</code>, <code>AddPhonetizerLanguageMapping()</code>, <code>AddForceChineseScript()</code>, <code>AddSpellingCorrection()</code>, <code>AddQuestionStrategy()</code>, <code>AddStopWordsRuleSets()</code>, <code>AddDefaultOperator()</code>, <code>AddAdvancedSearchParameters()</code>, <code>AddSearchParameters()</code>, <code>AddRfmV2Options()</code>, <code>AddQuestionLanguage()</code>, <code>AddConceptsLimit()</code>, <code>AddGlobalRelevance()</code>, <code>AddWordsRelevance()</code>, <code>AddRelevanceDelta()</code></li>
<li><code>AddRights()</code>: Adds the access rights sub-clause</li>
</ul>
</li>
<li><code>AddIn()</code>: Adds the IN clause of the SQL query</li>
<li><code>AddGroupBy()</code>: Adds the GROUP BY clause of the SQL query, based on the configuration of the Query web service (or a <code>groupBy</code> parameter included in the query, if any)</li>
<li><code>AddOrderBy()</code>: Adds the ORDER BY clause of the SQL query, based on the sorting options specified in the Query web service (and a <code>sort</code> parameter included in the query, if any)<!-- -->
<ul>
<li><code>AddSortOrderBy</code>: Adds the ORDER BY clause of the SQL query<!-- -->
<ul>
<li><code>GetCurrentSort</code>: Returns the ORDER BY expression based on the &quot;sorting choices&quot; configuration, taking into account tab search if configured. Checks are made for a relevance sort when no fulltext terms are active. In this case the default non-relevance sorting choice is returned.</li>
</ul>
</li>
</ul>
</li>
<li><code>AddPaging()</code>: Adds the SKIP/COUNT clause of the SQL query</li>
</ul>
<p>When overriding one of the above methods, one problem arises: these methods do not return a <code>string</code>, they write their output directly to a <code>StringBuilder</code> object. So, it is not possible to modify directly what the base method adds to the SQL query. For example, if we want to override the <code>AddFrom()</code> method to replace one index by another, the following does not work:</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public override void AddFrom(StringBuilder sb)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // This fails, because AddFrom() does not return anything!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // The output is written in the StringBuilder sb directly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string from = base.AddFrom(sb);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>But we can easily overcome this problem by using the following trick:</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public override void AddFrom(StringBuilder sb)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var sb2 = new StringBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    base.AddFrom(sb2); // Call the base method with a blank StringBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string from = sb2.ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Now we can modify the from clause if we want to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sb.Append(from); // Don&#x27;t forget to write the clause to the real StringBuilder at the end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This lets us modify any part of the SQL query sent to the engine.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="after-search-methods">After Search methods<a href="#after-search-methods" class="hash-link" aria-label="Direct link to After Search methods" title="Direct link to After Search methods">​</a></h3>
<p>After the SQL query is executed, the results from the engine are written in the <code>Response</code> object (which a simple <code>Json</code> container). The methods of the <code>QueryPlugin</code> starting with <code>Write</code> each write a piece of the results. These methods can all be overriden to customize what is actually sent back to the client.</p>
<ul>
<li><code>WritePredefinedAggregations()</code>: Writes the aggregations with predefined values (if any).</li>
<li><code>WriteTabResults()</code>: Writes the results for the query responsible for computing the tabs counters (when tab search is enabled<!-- -->
<ul>
<li><code>WriteTabs()</code>: Writes the current tab and the available tabs, as defined in the Query web service configuration</li>
<li><code>WriteAttributes()</code>: Writes the non-aggregation attributes (such as <code>matchingrowcount</code>, <code>processingtime</code>, etc.)</li>
<li><code>WriteAggregations()</code>: Writes the computed aggregations to the results<!-- -->
<ul>
<li><code>WriteAggregation()</code>: Writes one computed aggregation to the results. This method has access to both the computed data and the aggregation&#x27;s configuration in the Query web service.<!-- -->
<ul>
<li><code>WriteTreeAggregationLevel()</code>: For aggregations of type &quot;tree&quot; (eg. treepath), writes one level of the tree and its children in a recursive manner.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>WriteResults()</code>: Writes the results for the main query.<!-- -->
<ul>
<li><code>WriteScope()</code>: Writes the current scope and the available scopes, as defined in the Query web service configuration (similar to the tabs)</li>
<li><code>WriteSort()</code>: Writes the current &quot;sort&quot; value</li>
<li><code>WriteDidYouMean()</code>: Writes the &quot;did-you-mean&quot; object to the results. This is derived from the &quot;internalqueryanalysis&quot; attribute.</li>
<li><code>WriteAttributes()</code>: (as above, but for the main query)</li>
<li><code>WriteAggregations()</code>: (as above, but for the main query)</li>
<li><code>WriteRecords()</code>: Writes the list of <code>Record</code> objects retrieved by the engine. For each record, the data is retrieved from the <code>Cursor</code> object. Some helper methods can be overriden, to customize how some values are written:<!-- -->
<ul>
<li><code>IsEmpty()</code>: Returns TRUE if the passed value can be considered &quot;empty&quot;. Empty strings, numerics with value 0 and booleans with value false are all considered empty, and therefore not written in the record objects.</li>
<li><code>GetColumnValue()</code>: Returns the passed value for a particular column as a <code>Json</code> object. The form of the JSON object depends on the type of the column.</li>
<li><code>GetDisplayTitle()</code>: Returns the title field for the current record with highlighting applied using the &quot;title&quot; partname.</li>
<li><code>GetRelevantExtracts()</code>: Returns relevant extracts paragraph for the current record. HTML highlighting markup is applied to the extracts.</li>
<li><code>GetThumbnailUrl()</code>: Returns the thumbnail url for the current record.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Note the above methods manipulate <code>Json</code> objects, which have a rich set of methods for reading and writing values. As an example, the following piece of code produces a JSON object:</p>
<p>Code:</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var example = Json.NewObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var data = example.SetArray(&quot;data&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data.EltAdd(&quot;value1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data.EltAdd(42);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data.EltAdd(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example.Set(&quot;test&quot;, &quot;ok&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Result:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;data&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        42,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;test&quot;: &quot;ok&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-methods">Other methods<a href="#other-methods" class="hash-link" aria-label="Direct link to Other methods" title="Direct link to Other methods">​</a></h3>
<p>The <code>QueryPlugin</code> includes other customizable methods, notably:</p>
<p><strong>High-level methods</strong>, which wrap the ones described above:</p>
<ul>
<li><code>Execute()</code>: Executes the query (the highest-level method, which is rarely needed to override).<!-- -->
<ul>
<li><code>Init()</code>: Wraps the initialization methods described above.</li>
<li><code>ExecuteQuery()</code>: Executes the query. This calls &quot;DoQuery&quot; preceded by a call to &quot;DoTabQuery&quot; if tab search is configured.<!-- -->
<ul>
<li><code>DoTabQuery()</code>: Executes the tab query and writes the results. This method (and the one below) wrap the &quot;Before Search&quot; and &quot;After Search&quot; methods described above. In particular they call the <code>ToSql()</code>, <code>WriteTabResults()</code> and <code>WriteResults()</code> methods.</li>
<li><code>DoQuery()</code>: Executes the main query and writes the results</li>
</ul>
</li>
<li><code>Term()</code>: Cleans up this QueryPlugin instance. Members are set to their default values and the &quot;Client&quot; is returned to the pool unless it is external.</li>
</ul>
</li>
</ul>
<p><strong>Query intent detection methods</strong>, which analyze the query text to detect an intent of the user, which can modify some members of the <code>QueryPlugin</code> to modify the search query:</p>
<ul>
<li><code>MatchQueryIntents()</code>: Initializes the &quot;QueryAnalysis&quot; member and then matches any configured query intents. If the &quot;QueryAnalysis&quot; already exists, as can be the case when processing the main query during tab search, then any query intent actions are applied<!-- -->
<ul>
<li><code>AnalyseQuery()</code>: Analyzes the text held in the &quot;Text&quot; member and returns an &quot;IQueryAnalysis&quot; instance. This method executes a custom SQL query, to get the text analysis from the engine.<!-- -->
<ul>
<li><code>ToSqlForQueryAnalysis()</code>: Generates a SELECT statement used to produce an &quot;IQueryAnalysis&quot; instance.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="json-method-plugins">Json Method Plugins<a href="#json-method-plugins" class="hash-link" aria-label="Direct link to Json Method Plugins" title="Direct link to Json Method Plugins">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-custom-endpoint">Create a custom endpoint<a href="#create-a-custom-endpoint" class="hash-link" aria-label="Direct link to Create a custom endpoint" title="Direct link to Create a custom endpoint">​</a></h3>
<p>A <code>JsonMethodPlugin</code> is a C# plugin deployed on the Sinequa server that exposes a custom endpoint of the Sinequa REST API. A <code>JsonMethodPlugin</code> has access to the full Sinequa C# API, so it can do practically anything, including one or multiple queries to the Sinequa engines.</p>
<p>The complete API of the <code>JsonMethodPlugin</code> is listed on <a href="https://doc.sinequa.com/api/.net/html/Methods_T_Sinequa_Plugins_JsonMethodPlugin.htm" target="_blank" rel="noopener noreferrer">Sinequa&#x27;s documentation website</a>.</p>
<p>As an example, let&#x27;s take the following plugin:</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class MyJsonMethodPlugin : JsonMethodPlugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override void OnPluginMethod()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var input = JsonRequest.ValueStr(&quot;input&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JsonResponse.Set(&quot;output&quot;, &quot;Hello, &quot; + input);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A POST request to <code>/api/v1/plugin/MyJsonMethodPlugin</code> with the following body:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;input&quot;: &quot;World!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Yields the following response:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;output&quot;: &quot;Hello, World!&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;methodresult&quot;: &quot;ok&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>@sinequa/core</code> library includes a service to easily sent GET/POST requests to a <code>JsonMethodPlugin</code>, as illustrated in the following example:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> JsonMethodPluginService </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@sinequa/core/web-services&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> pluginService</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> JsonMethodPluginService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">example</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Send request to the plugin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> obs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pluginService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;MyJsonMethodPlugin&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">input</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;World!&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Subscribe to response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        obs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">output</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that even an empty <code>JsonMethodPlugin</code> performs things like user authentication (taking into account the different types of SSO). By default, only administrators are allowed to use these plugins, but it is possible to change this rule by overriding the <code>GetRequiredAuthLevel()</code> method:</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public override JsonMethodAuthLevel GetRequiredAuthLevel()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return JsonMethodAuthLevel.User; // Any authenticated user can use the plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>There are four levels: <code>User</code>, <code>Admin</code>, <code>AdminOrDelegatedAdmin</code> and <code>None</code>. Note that it is possible to retrieve the user&#x27;s identity via <code>this.Session.User</code>. Additionally, <code>this.Session</code> has the following properties indicating whether the current user is an admin or delegated admin: <code>IsAdmin</code>, <code>IsDelegatedAdmin</code>, and <code>IsAdminOrDelegatedAdmin</code> .</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="customizing-existing-web-services">Customizing existing web services<a href="#customizing-existing-web-services" class="hash-link" aria-label="Direct link to Customizing existing web services" title="Direct link to Customizing existing web services">​</a></h3>
<p>Additionally, it is possible to use a <code>JsonMethodPlugin</code> in the context of another web service, instead of as an independent endpoint. This gives the possibility to customize the behavior of an existing web service, which, unlike the Query web service, does not have a dedicated plugin type.</p>
<p>For example, we can post process the suggestions returned by the Suggest Query web service, by adding the name of our plugin to the body of the request:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;app&quot;: &quot;app&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;suggestQuery&quot;: &quot;myQuery&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;text&quot;: &quot;barack ob&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;plugin&quot;: &quot;MyJsonMethodPlugin&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;input&quot;: &quot;World!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, in this case, the <code>OnPluginMethod()</code> method is not called. Instead, we can override our plugin logic in <code>OnBegin()</code> (to pre-process the request) or <code>OnEnd()</code> (to post-process the request).</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/sinequa/sba-angular/tree/main/docs/tipstricks/plugins.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sba-angular/docs/tipstricks/audit"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Auditing applications</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/sba-angular/docs/tipstricks/startup"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Application Startup</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#query-plugins" class="table-of-contents__link toc-highlight">Query Plugins</a><ul><li><a href="#initialization-methods" class="table-of-contents__link toc-highlight">Initialization methods</a></li><li><a href="#before-search-methods" class="table-of-contents__link toc-highlight">Before Search methods</a></li><li><a href="#after-search-methods" class="table-of-contents__link toc-highlight">After Search methods</a></li><li><a href="#other-methods" class="table-of-contents__link toc-highlight">Other methods</a></li></ul></li><li><a href="#json-method-plugins" class="table-of-contents__link toc-highlight">Json Method Plugins</a><ul><li><a href="#create-a-custom-endpoint" class="table-of-contents__link toc-highlight">Create a custom endpoint</a></li><li><a href="#customizing-existing-web-services" class="table-of-contents__link toc-highlight">Customizing existing web services</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sba-angular/docs/tutorial/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/sinequa" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://sinequa.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/sinequa/sba-angular" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 <a href="https://www.sinequa.com" aria-alt="Sinequa website">Sinequa</a>. Distributed under the terms of the <a href="https://github.com/sinequa/sba-angular/blob/master/license.txt" aria-alt="MIT license">MIT license</a></div></div></div></footer></div>
</body>
</html>