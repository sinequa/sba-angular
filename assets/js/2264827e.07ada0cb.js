"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8147],{4248:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>c});var s=i(74848),r=i(28453);const d={layout:"default",title:"Deployment",parent:"Guides",sidebar_position:4},t="Deploying an application",o={id:"guides/deployment",title:"Deployment",description:"Build process",source:"@site/docs/guides/4-deployment.md",sourceDirName:"guides",slug:"/guides/deployment",permalink:"/sba-angular/docs/guides/deployment",draft:!1,unlisted:!1,editUrl:"https://github.com/sinequa/sba-angular/tree/main/docs/guides/4-deployment.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{layout:"default",title:"Deployment",parent:"Guides",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Development",permalink:"/sba-angular/docs/guides/development"},next:{title:"Version control",permalink:"/sba-angular/docs/guides/version-control"}},l={},c=[{value:"Build process",id:"build-process",level:2},{value:"Deploying an SBA on a Sinequa server",id:"deploying-an-sba-on-a-sinequa-server",level:2},{value:"Example:",id:"example",level:3},{value:"Workspace content",id:"workspace-content",level:3},{value:"Debug version",id:"debug-version",level:3},{value:"Deploying an SBA on another server",id:"deploying-an-sba-on-another-server",level:2}];function a(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"deploying-an-application",children:"Deploying an application"}),"\n",(0,s.jsx)(n.h2,{id:"build-process",children:"Build process"}),"\n",(0,s.jsxs)(n.p,{children:["Your build process may be entirely manual, entirely automated (via ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Continuous_deployment",children:"Continuous Deployment"}),"), or something in-between."]}),"\n",(0,s.jsx)(n.p,{children:"For example, your environment might look like this:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Your workspace is hosted on a Git repository (e.g., GitHub, Gitlab, Bitbucket, etc.)."}),"\n",(0,s.jsxs)(n.li,{children:["When a ",(0,s.jsx)(n.code,{children:"git push"})," is made to the ",(0,s.jsx)(n.code,{children:"main"})," branch, a CI/CD pipeline is triggered (e.g., via GitHub Actions, Jenkins, etc.)."]}),"\n",(0,s.jsx)(n.li,{children:"The pipeline builds the application and runs some end-to-end tests"}),"\n",(0,s.jsx)(n.li,{children:"When successful, the pipeline copies the build artifacts to your Sinequa server"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There could be many variations of this process, but the key steps are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Building the application with e.g., ",(0,s.jsx)(n.code,{children:"npm run buildvanilla"})," (see ",(0,s.jsx)(n.a,{href:"/sba-angular/docs/guides/development#building-an-app",children:"Building an app"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Serving the build artifact (i.e., the ",(0,s.jsx)(n.code,{children:"dist"})," folder) on a web server (which is often a Sinequa server)."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"deploying-an-sba-on-a-sinequa-server",children:"Deploying an SBA on a Sinequa server"}),"\n",(0,s.jsxs)(n.p,{children:["Sinequa serves the ",(0,s.jsx)(n.code,{children:"dist"})," folder of the workspace of an app at the URL ",(0,s.jsx)(n.code,{children:"https://<sinequa server>/app/<app name>"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"Example:"}),"\n",(0,s.jsx)(n.p,{children:"Let's assume:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Your Sinequa server is hosted at ",(0,s.jsx)(n.code,{children:"https://example.com"})]}),"\n",(0,s.jsx)(n.li,{children:'Your app (in the Sinequa configuration) is named "foo"'}),"\n",(0,s.jsx)(n.li,{children:'Your workspace folder is named "bar".'}),"\n",(0,s.jsx)(n.li,{children:'Your Angular application within that workspace is named "baz".'}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Then:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Your application will be available at ",(0,s.jsx)(n.code,{children:"https://example.com/app/foo"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Your app configuration will look like:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"App configuration",src:i(70641).A+"",width:"543",height:"191"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"You workspace folder will look like:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Worskpace folder",src:i(44430).A+"",width:"475",height:"359"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"workspace-content",children:"Workspace content"}),"\n",(0,s.jsxs)(n.p,{children:["On the Sinequa server, the project workspace is stored in ",(0,s.jsx)(n.code,{children:"<sinequa data folder>/sba"}),". The workspace does not need to include the source code or node modules. For deployment, only the ",(0,s.jsx)(n.code,{children:"dist"})," folder is needed (along with a few config files). This is summarized in this table:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Folder/File"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needed for build"}),(0,s.jsx)(n.th,{children:"Needed for deployment"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"projects"})}),(0,s.jsx)(n.td,{children:"Source code of projects"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"node_modules"})}),(0,s.jsxs)(n.td,{children:["Dependencies (installed via ",(0,s.jsx)(n.code,{children:"npm install"}),")"]}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"dist"})}),(0,s.jsxs)(n.td,{children:["Build artifacts (generated via ",(0,s.jsx)(n.code,{children:"npm run build"}),")"]}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"package.json"})}),(0,s.jsx)(n.td,{children:"Project configuration"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"angular.json"})}),(0,s.jsx)(n.td,{children:"Angular configuration"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sba-workspace.xml"})}),(0,s.jsx)(n.td,{children:"Sinequa configuration object"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["It is possible to run the build command (e.g., ",(0,s.jsx)(n.code,{children:"npm run buildvanilla"}),") via the administration interface to generate the ",(0,s.jsx)(n.code,{children:"dist"})," folder. (This requires the ",(0,s.jsx)(n.code,{children:"projects"})," and ",(0,s.jsx)(n.code,{children:"node_modules"})," folders.) Conversely, if your build is generated in a CI/CD pipeline, do not bother uploading the ",(0,s.jsx)(n.code,{children:"projects"})," and ",(0,s.jsx)(n.code,{children:"node_modules"})," to Sinequa."]}),"\n",(0,s.jsx)(n.h3,{id:"debug-version",children:"Debug version"}),"\n",(0,s.jsxs)(n.p,{children:["In addition to serving the ",(0,s.jsx)(n.code,{children:"dist"})," folder at the ",(0,s.jsx)(n.code,{children:"/app/<app name>"})," URL, Sinequa also serves the ",(0,s.jsx)(n.code,{children:"dist-debug"})," folder at the ",(0,s.jsx)(n.code,{children:"/app-debug/<app name>"})," URL."]}),"\n",(0,s.jsxs)(n.p,{children:["This is useful when building your application in development mode (using ",(0,s.jsx)(n.code,{children:"npm run build <app name> -- --configuration=development"}),"), which generates a ",(0,s.jsx)(n.code,{children:"dist-debug"})," folder instead of a ",(0,s.jsx)(n.code,{children:"dist"})," folder. The debug version can be inspected with the browser's developer tools, which is very useful for debugging. It is equivalent to the version served by ",(0,s.jsx)(n.code,{children:"ng serve"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"deploying-an-sba-on-another-server",children:"Deploying an SBA on another server"}),"\n",(0,s.jsxs)(n.p,{children:["An SBA can be deployed on any kind of static web server. Simply copy the ",(0,s.jsx)(n.code,{children:"dist"})," folder to the server and serve it at the URL of your choice."]}),"\n",(0,s.jsx)(n.p,{children:"However, when the URL of the SBA is different from the URL of the Sinequa server, there are two issues to consider:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The SBA cannot send requests to relative URLs (e.g., ",(0,s.jsx)(n.code,{children:"/api/v1/query"}),"), which is the default. It needs an absolute URL."]}),"\n",(0,s.jsxs)(n.li,{children:["Cross-origin requests must be enabled to avoid CORS errors (See ",(0,s.jsx)(n.a,{href:"/sba-angular/docs/guides/server-config#cors-and-webapp-configuration",children:"CORS and WebApp configuration"}),")."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This is exactly the same issue as when using ",(0,s.jsx)(n.code,{children:"ng serve"})," (See ",(0,s.jsx)(n.a,{href:"/sba-angular/docs/guides/development#development-configuration",children:"Development configuration"}),")."]}),"\n",(0,s.jsx)(n.p,{children:"And similarly, these issues can be solved with the following approaches:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"by setting up a proxy (i.e., a web server that forwards requests from the SBA host to the Sinequa server)."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"OR:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["by enabling cross-origin requests on the Sinequa server (e.g., adding ",(0,s.jsx)(n.code,{children:"https://<sba-host>"})," to the Permitted Origins in your ",(0,s.jsx)(n.em,{children:"WebApp > Stateless Mode"})," configuration)."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["by specifying the URL of the Sinequa server in the ",(0,s.jsx)(n.code,{children:"StartConfig"})," object in your ",(0,s.jsx)(n.code,{children:"app.module.ts"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'export const startConfig: StartConfig = {\n    url: "https://my-sinequa-server",\n    app: "<name of your app>",\n    production: environment.production\n};\n'})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},70641:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/app-deployment-638a1db4c9d16d61bb874a5434e1ceb1.png"},44430:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/workspace-folder-104ac0a0e0ec86b0bd9ff93d1838d1b5.png"},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var s=i(96540);const r={},d=s.createContext(r);function t(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);